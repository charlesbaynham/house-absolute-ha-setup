- id: '1742124552238'
  alias: Living room lights copy main
  description: ''
  triggers:
  - domain: mqtt
    device_id: b44f30835f4c82fab781ed7ca5d3c901
    type: action
    subtype: single_left
    trigger: device
  conditions: []
  actions:
  - delay:
      hours: 0
      minutes: 0
      seconds: 1
      milliseconds: 0
  - if:
    - condition: device
      type: is_off
      device_id: b44f30835f4c82fab781ed7ca5d3c901
      entity_id: 2171f345562f270f7e227a2561c88b8b
      domain: switch
    then:
    - action: light.turn_off
      metadata: {}
      data: {}
      target:
        area_id: living_room
    else:
    - action: light.turn_on
      metadata: {}
      data:
        effect: stop_hue_effect
      target:
        area_id: living_room
    - delay:
        hours: 0
        minutes: 0
        seconds: 1
        milliseconds: 0
    - action: light.turn_on
      metadata: {}
      data:
        effect: stop_effect
      target:
        area_id: living_room
  mode: restart
- id: '1742126819014'
  alias: Bedroom dimmer switch
  description: ''
  use_blueprint:
    path: patpac9/Hue_Dimmer_Switch_Easy_Custom_Buttons.yaml
    input:
      controller: Hue dimmer switch 1
      on_released:
      - action: light.turn_on
        metadata: {}
        data: {}
        target:
          area_id: bedroom
      off_released:
      - action: light.turn_off
        metadata: {}
        data: {}
        target:
          area_id: bedroom
      up_released:
      - action: light.turn_on
        metadata: {}
        data: {}
        target:
          device_id: 4e798fe039ef3b748b3e8c867f3fcb68
      down_released:
      - action: light.turn_off
        metadata: {}
        data: {}
        target:
          device_id: 4e798fe039ef3b748b3e8c867f3fcb68
- id: '1742137223032'
  alias: Kitchen motion
  description: ''
  triggers:
  - trigger: state
    entity_id: binary_sensor.motion_sensor_kitchen_occupancy
    from: 'off'
    to: 'on'
  - trigger: state
    entity_id:
    - input_boolean.kitchen_motion_enabled
    to: 'on'
  conditions:
  - condition: state
    entity_id: input_boolean.kitchen_motion_enabled
    state: 'on'
  - condition: state
    entity_id: binary_sensor.motion_sensor_kitchen_occupancy
    state: 'on'
  actions:
  - alias: Turn on the light
    action: light.turn_on
    target:
      area_id: kitchen
    data: {}
  - alias: Wait until there is no motion from device
    wait_for_trigger:
      trigger: state
      entity_id: binary_sensor.motion_sensor_kitchen_occupancy
      from: 'on'
      to: 'off'
  - alias: Wait the number of seconds that has been set
    delay: 120
  - alias: Turn off the light
    action: light.turn_off
    target:
      area_id: kitchen
    data: {}
  mode: restart
  max_exceeded: silent
- id: '1745325342231'
  alias: Kitchen motion controlled by switch
  description: ''
  triggers:
  - domain: mqtt
    device_id: bb9532358b487e4b89cfe0e3b76b91e0
    type: action
    subtype: single_left
    trigger: device
  conditions: []
  actions:
  - action: input_boolean.toggle
    metadata: {}
    data: {}
    target:
      entity_id: input_boolean.kitchen_motion_enabled
  mode: single
- id: '1745327309760'
  alias: Kitchen switch update with motion state
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - input_boolean.kitchen_motion_enabled
    for:
      hours: 0
      minutes: 0
      seconds: 5
  conditions: []
  actions:
  - if:
    - condition: state
      entity_id: input_boolean.kitchen_motion_enabled
      state: 'on'
    then:
    - type: turn_on
      device_id: bb9532358b487e4b89cfe0e3b76b91e0
      entity_id: 8afbce029373c30cdf50bb2f317faee5
      domain: switch
    else:
    - type: turn_off
      device_id: bb9532358b487e4b89cfe0e3b76b91e0
      entity_id: 8afbce029373c30cdf50bb2f317faee5
      domain: switch
  mode: restart
- id: '1745327896846'
  alias: Kitchen button controls surface lights
  description: ''
  triggers:
  - domain: mqtt
    device_id: bb9532358b487e4b89cfe0e3b76b91e0
    type: action
    subtype: single_right
    trigger: device
  conditions: []
  actions:
  - if:
    - condition: device
      type: is_on
      device_id: bb9532358b487e4b89cfe0e3b76b91e0
      entity_id: 81a39d335fe37927b2849f2eef94b6ed
      domain: light
    then:
    - type: turn_on
      device_id: f4b4e900064fe24bcc24ab77d53af88a
      entity_id: 97c5afcebb430bd9c36137a010c70301
      domain: switch
    else:
    - type: turn_off
      device_id: f4b4e900064fe24bcc24ab77d53af88a
      entity_id: 97c5afcebb430bd9c36137a010c70301
      domain: switch
  mode: single
- id: '1745709642332'
  alias: Living room cosy button
  description: Toggle the room light between cosy mode and off
  triggers:
  - domain: mqtt
    device_id: d74916d94f1f149b3d2eec73d3b68b7f
    type: action
    subtype: single
    trigger: device
  actions:
  - if:
    - condition: or
      conditions:
      - condition: device
        type: is_on
        device_id: b44f30835f4c82fab781ed7ca5d3c901
        entity_id: 50a81e844d29005a81f8f93a9c3f2572
        domain: light
      - condition: device
        type: is_off
        device_id: 3347d22c9d7e7a4461d273a892cd2fca
        entity_id: 716fb4b36b4f199e124d8edf555abb7d
        domain: light
    then:
    - action: scene.turn_on
      metadata: {}
      data:
        transition: 3
      target:
        entity_id: scene.living_room_cosy
    - action: light.turn_off
      metadata: {}
      data: {}
      target:
        area_id: kitchen
    else:
    - action: light.turn_off
      metadata: {}
      data: {}
      target:
        area_id: living_room
    - action: light.turn_off
      metadata: {}
      data: {}
      target:
        area_id: kitchen
  mode: single
- id: '1748385723267'
  alias: Master bedroom light dimmer switch
  description: ''
  use_blueprint:
    path: patpac9/Hue_Dimmer_Switch_Easy_Custom_Buttons.yaml
    input:
      controller: Master bedroom wireless switch
      up_released:
      - action: cover.open_cover
        metadata: {}
        data: {}
        target:
          area_id: master_bedroom
      on_released:
      - action: light.turn_on
        metadata: {}
        data: {}
        target:
          area_id: master_bedroom
      off_released:
      - action: light.turn_off
        metadata: {}
        data: {}
        target:
          area_id: master_bedroom
      down_released:
      - action: cover.close_cover
        metadata: {}
        data: {}
        target:
          area_id: master_bedroom
      on_hold_released:
      - action: scene.turn_on
        metadata: {}
        data:
          transition: 3
        target:
          entity_id: scene.master_bedroom_chill
- id: gardenlightsmotinoandsun
  alias: Turn on living room light when garden motion and sun is down
  description: Triggers on motion or sunset, checks both motion and sun conditions
  triggers:
  - entity_id:
    - binary_sensor.garden_motion_occupancy
    to: 'on'
    trigger: state
  - event: sunset
    trigger: sun
  conditions:
  - condition: state
    entity_id: binary_sensor.garden_motion_occupancy
    state: 'on'
  - condition: sun
    after: sunset
  actions:
  - target:
      area_id: garden
    action: light.turn_on
    data: {}
  - wait_for_trigger:
    - entity_id:
      - binary_sensor.garden_motion_occupancy
      to: 'off'
      for:
        hours: 0
        minutes: 5
        seconds: 0
      trigger: state
    timeout: 02:00:00
    continue_on_timeout: true
  - target:
      area_id: garden
    action: light.turn_off
    data: {}
  mode: restart
- id: '1760784792347'
  alias: Restart let's encrypt daily
  description: ''
  triggers:
  - trigger: time
    at: 02:00:00
  conditions: []
  actions:
  - action: hassio.addon_restart
    metadata: {}
    data:
      addon: core_letsencrypt
  mode: single
- id: '1729425600000'
  alias: Turn off all lights when everyone leaves
  description: Automatically turn off all lights when no one is home
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.anyone_home
    from: 'on'
    to: 'off'
    for:
      hours: 0
      minutes: 5
      seconds: 0
  conditions: []
  actions:
  - action: light.turn_off
    metadata: {}
    data: {}
    target:
      area_id:
      - master_bedroom
      - kitchen
      - hallway
      - living_room
      - bedroom
      - garden
  mode: single
- id: '1729776000000'
  alias: Auto-commit configuration changes
  description: Automatically commit and push HA configuration changes every 30 minutes
  triggers:
  - trigger: time_pattern
    minutes: /5
  conditions: []
  actions:
  - action: shell_command.git_commit_push
    metadata: {}
    data: {}
    response_variable: response
  mode: single
- id: '1761476521000'
  alias: Hallway motion
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.hallway_motion_occupancy
    from: 'off'
    to: 'on'
  - trigger: state
    entity_id: binary_sensor.front_door_sensor_contact
    from: 'off'
    to: 'on'
  - trigger: state
    entity_id:
    - input_boolean.hallway_motion_enabled
    to: 'on'
  conditions:
  - condition: state
    entity_id: input_boolean.hallway_motion_enabled
    state: 'on'
  - condition: or
    conditions:
    - condition: state
      entity_id: binary_sensor.hallway_motion_occupancy
      state: 'on'
    - condition: state
      entity_id: binary_sensor.front_door_sensor_contact
      state: 'on'
  actions:
  - alias: Turn on the light
    action: light.turn_on
    target:
      area_id: hallway
    data: {}
  - alias: Wait until there is no motion
    wait_for_trigger:
    - trigger: state
      entity_id:
      - binary_sensor.hallway_motion_occupancy
      from: 'on'
      to: 'off'
    timeout:
      hours: 0
      minutes: 10
      seconds: 0
      milliseconds: 0
    continue_on_timeout: true
  - alias: Wait the number of seconds that has been set
    delay:
      hours: 0
      minutes: 5
      seconds: 0
      milliseconds: 0
  - alias: Turn off the light
    action: light.turn_off
    target:
      area_id: hallway
    data: {}
  mode: restart
  max_exceeded: silent
- id: '1761479998275'
  alias: Sync master bedroom TRV with external sensor
  description: ''
  use_blueprint:
    path: photomoose/sonoff-trvzb-external-temperature-sensor-calibration.yaml
    input:
      external_temperature_sensor: sensor.sensor_master_bedroom_temperature
      trv_external_temperature_input:
      - number.trv_master_bedroom_external_temperature_input
- id: '1761512302799'
  alias: Sync living room TRV with external sensor
  description: ''
  use_blueprint:
    path: photomoose/sonoff-trvzb-external-temperature-sensor-calibration.yaml
    input:
      external_temperature_sensor: sensor.sensor_living_room_temperature
      trv_external_temperature_input:
      - number.trv_living_room_external_temperature_input
- id: '1761691019774'
  alias: Living room TRV - sync valve with helper
  description: 'Copy the settings from the 0 - 100 helper to the TRV valve position.
    This will be controlled by a PID controller from Smart thermostat (PID) - see
    the YAML. '
  use_blueprint:
    path: arnie580/sonoff-trv-pid.yaml
    input:
      thermostat_value: input_number.living_room_trv_valve_position
      max_valve_opening: number.trv_living_room_valve_opening_degree
      max_valve_closing: number.trv_living_room_valve_closing_degree
- id: '1762091898797'
  alias: Cosy button long press
  description: ''
  triggers:
  - domain: mqtt
    device_id: d74916d94f1f149b3d2eec73d3b68b7f
    type: action
    subtype: long
    trigger: device
  conditions: []
  actions:
  - action: light.turn_on
    metadata: {}
    data:
      effect: Stop_hue_effect
    target:
      area_id: living_room
  mode: single
- id: '1762099115353'
  alias: Bedroom lights copy main
  description: ''
  triggers:
  - domain: mqtt
    device_id: 0dac4ca1d28c7cdb4a3517b64d5aaa21
    type: action
    subtype: single
    trigger: device
  conditions: []
  actions:
  - delay:
      hours: 0
      minutes: 0
      seconds: 0
      milliseconds: 300
  - if:
    - condition: device
      type: is_off
      device_id: 0dac4ca1d28c7cdb4a3517b64d5aaa21
      entity_id: 45612e367dd14a46907b2f8cc54bafdc
      domain: light
    then:
    - action: light.turn_off
      metadata: {}
      data: {}
      target:
        area_id:
        - bedroom
    else:
    - action: light.turn_on
      metadata: {}
      data:
        effect: stop_hue_effect
      target:
        area_id:
        - bedroom
  mode: restart
- id: '1761691019775'
  alias: Master bedroom TRV - sync valve with helper
  description: 'Copy the settings from the 0 - 100 helper to the TRV valve position.
    This will be controlled by a PID controller from Smart thermostat (PID) - see
    the YAML. '
  use_blueprint:
    path: arnie580/sonoff-trv-pid.yaml
    input:
      thermostat_value: input_number.master_bedroom_trv_valve_position
      max_valve_opening: number.trv_master_bedroom_valve_opening_degree
      max_valve_closing: number.trv_master_bedroom_valve_closing_degree
- id: '1731536616000'
  alias: Bedroom TRV - sync valve with helper
  description: 'Copy the settings from the 0 - 100 helper to the TRV valve position.
    This will be controlled by a PID controller from Smart thermostat (PID) - see
    the YAML. '
  use_blueprint:
    path: arnie580/sonoff-trv-pid.yaml
    input:
      thermostat_value: input_number.bedroom_trv_valve_position
      max_valve_opening: number.trv_bedroom_valve_opening_degree
      max_valve_closing: number.trv_bedroom_valve_closing_degree
- id: '1730595645000'
  alias: Vacuum when everyone leaves
  description: Start the vacuum 30 minutes after the last person leaves, max once
    per day
  triggers:
  - trigger: state
    entity_id: binary_sensor.anyone_home
    from: 'on'
    to: 'off'
  conditions:
  - condition: template
    value_template: '{% set last_run = state_attr(''automation.vacuum_when_everyone_leaves'',
      ''last_triggered'') %} {{ last_run == none or (now() - last_run).total_seconds()
      > 72000 }}

      '
  - condition: state
    entity_id: input_boolean.night_mode
    state: 'off'
  actions:
  - delay:
      hours: 0
      minutes: 30
      seconds: 0
  - action: vacuum.start
    metadata: {}
    data: {}
    target:
      device_id:
      - 8494972a3e4dd42011930160e8845cec
  mode: single
- id: '1731542000000'
  alias: Activate night mode
  description: Turn on night mode when non-bedroom lights are off for 5 minutes and
    someone is home
  triggers:
  - trigger: state
    entity_id: binary_sensor.non_bedroom_lights_off
    to: 'on'
    for:
      minutes: 5
  conditions:
  - condition: state
    entity_id: binary_sensor.anyone_home
    state: 'on'
  - condition: time
    after: '21:00:00'
  actions:
  - action: input_boolean.turn_on
    metadata: {}
    data: {}
    target:
      entity_id: input_boolean.night_mode
  mode: single
- id: '1731542000001'
  alias: Deactivate night mode at 7:30 AM
  description: Turn off night mode every morning at 7:30 AM
  triggers:
  - trigger: time
    at: 07:30:00
  conditions: []
  actions:
  - action: input_boolean.turn_off
    metadata: {}
    data: {}
    target:
      entity_id: input_boolean.night_mode
  mode: single
- id: '1763109049950'
  alias: Sync adaptive lighting sleep mode with night mode
  description: Turn on/off adaptive lighting sleep mode when night mode changes
  triggers:
  - trigger: state
    entity_id: input_boolean.night_mode
  conditions: []
  actions:
  - if:
    - condition: state
      entity_id: input_boolean.night_mode
      state: 'on'
    then:
    - action: switch.turn_on
      metadata: {}
      data: {}
      target:
        entity_id: switch.adaptive_lighting_sleep_mode_rest_of_house
    else:
    - action: switch.turn_off
      metadata: {}
      data: {}
      target:
        entity_id: switch.adaptive_lighting_sleep_mode_rest_of_house
  mode: single
- id: '1731600000000'
  alias: Morse code greeting at 10:05 PM
  description: Flash living room lights in Morse code spelling "hello Charles" at
    10:05 PM daily
  triggers:
  - trigger: time
    at: '22:05:00'
  conditions: []
  actions:
  - action: script.morse_code_hello_charles
    metadata: {}
    data: {}
  mode: single
- id: '1763508383336'
  alias: Master bedroom restart heating at 4am
  description: ''
  triggers:
  - trigger: time
    at: 04:00:00
  conditions: []
  actions:
  - action: climate.set_temperature
    metadata: {}
    data:
      temperature: 22
      hvac_mode: heat
    target:
      entity_id: climate.master_bedroom_trv_pid_controller
  - action: automation.turn_off
    metadata: {}
    data:
      stop_actions: false
    target:
      entity_id: automation.master_bedroom_restart_heating_at_4am
  mode: single
